<head>
    <title>SqlBP: View</title>
</head>
<div id="header-placeholder"></div>
    <script src="../JS/load_HeaderFooter.js"></script>
    <!-- include jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- send AJAX request to PHP script -->
    <script>
    $(document).ready(function() {
        $.ajax({
            url: "../PHP/get_database.php",
            type: "POST",
            success: function(response) {
                $('.db-list').html(response);
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    });
    $(document).ready(function() {
        $.ajax({
            url: "../PHP/get_tables.php",
            type: "POST",
            success: function(response) {
                $('.tables-list').html(response);
            },
            error: function(xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    });
    $(document).ready(function() {
    // Parse the URL to get the parameter values
    var params = new URLSearchParams(window.location.search);
    var database = params.get('database');
    var table = params.get('table');

    // Send the AJAX request with the parameters
    $.ajax({
        url: "../PHP/get_content.php",
        type: "GET",
        data: { database: database, table: table },
        success: function(response) {
            $('.content').html(response);
        },
        error: function(xhr, status, error) {
            console.log(xhr.responseText);
        }
    });
});

    </script>
</div>

<body>
    <div class="container" style="width: 100%;">
    <!--<div class="sidebar db-list"></div>-->
    <!--<div class="sidebar tables-list"></div>-->
        <main class="main-content">   
            <div class="tab">
                <div class="scrollable-tabs-container">
                    <!--LEFT ARROW-->
                    <div class="left-arrow"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/></svg></div>
                    <div class="tables-list"><script src="../PHP/get_tables.php"></script></div>
                    <!--RIGTH ARROW-->
                    <div class="right-arrow active"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"/></svg></div>
                </div>
                <script src="../JS/scroll_tabs.js"></script>
            </div>
            <div class="content"></div>
        </main>
    </div>
        <!-- HTML code for the query builder section -->
    <div class="container" style="width: auto; margin-left: 5%;">
        <h3>Query Builder</h3>

        <div>
            <label for="tables-select">Select tables:</label>
            <select id="tables-select" multiple>
                <!-- Options for the table select element will be populated dynamically -->
            </select>
        </div>

        <div>
            <label for="columns-select">Select columns:</label>
            <select id="columns-select" multiple>
                <!-- Options for the column select element will be populated dynamically -->
            </select>
        </div>

        <div>
            <label for="where-input">Where:</label>
            <input id="where-input" type="text" placeholder="Enter a WHERE clause">
        </div>

        <div>
            <label for="group-by-select">Group By:</label>
            <select id="group-by-select">
                <!-- Options for the Group By select element will be populated dynamically -->
            </select>
        </div>

        <div>
            <label for="order-by-select">Order By:</label>
            <select id="order-by-select">
                <!-- Options for the Order By select element will be populated dynamically -->
            </select>

            <label for="order-direction-select">Direction:</label>
            <select id="order-direction-select">
                <option value="ASC">Ascending</option>
                <option value="DESC">Descending</option>
            </select>
        </div>

        <div>
            <button onclick="buildQuery()">Build Query</button>
        </div>

        <div>
            <label for="query-output">Query Output:</label>
            <textarea id="query-output" readonly></textarea>
        </div>
    
    <!-- JavaScript code to populate the column, Group By, and Order By select elements -->
    <script>
            function populateTableSelect() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
            var tables = JSON.parse(this.responseText);
            var select = document.getElementById("table-select");

            // Add an option for each table
            for (var i = 0; i < tsables.length; i++) {
                var option = document.createElement("option");
                option.value = tables[i];
                option.textContent = tables[i];
                select.appendChild(option);
            }
            }
        };
        xhttp.open("GET", "get_tables.php", true);
        xhttp.send();
        }

        function populateColumnSelect() {
        var selectedTables = Array.from(document.querySelectorAll("#table-select option:checked")).map(el => el.value);

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
            var columns = JSON.parse(this.responseText);
            var select = document.getElementById("columns-select");

            // Add an option for each column
            for (var i = 0; i < columns.length; i++) {
                var option = document.createElement("option");
                option.value = columns[i];
                option.textContent = columns[i];
                select.appendChild(option);
            }
            }
        };
        xhttp.open("GET", "get_table_columns.php?tables=" + JSON.stringify(selectedTables), true);
        xhttp.send();
        }

        function buildQuery() {
        var selectedTables = Array.from(document.querySelectorAll("#table-select option:checked")).map(el => el.value);
        var selectedColumns = Array.from(document.querySelectorAll("#columns-select option:checked")).map(el => el.value);
        var whereClause = document.getElementById("where-input").value.trim();
        var groupBy = document.getElementById("group-by-select").value.trim();
        var orderBy = document.getElementById("order-by-select").value.trim();
        var orderDirection = document.getElementById("order-direction-select").value.trim();

        // Build the SELECT statement
        var query = "SELECT ";
        if (selectedColumns.length === 0) {
            query += "*";
        } else {
            query += selectedColumns.join(", ");
        }
        query += " FROM " + selectedTables.join(", ");
        if (whereClause !== "") {
            query += " WHERE " + whereClause;
        }
        if (groupBy !== "") {
            query += " GROUP BY " + groupBy;
        }
        if (orderBy !== "") {
            query += " ORDER BY " + orderBy + " " + orderDirection;
        }

        // Display the SELECT statement
        document.getElementById("query-output").value = query;
        }

    </script>
    <script>
        $('.tab').click(function () {
            $('.tab').removeClass('active');
            $(this).addClass('active');
        });
    </script>

</body>
<div id="footer-placeholder"></div>
